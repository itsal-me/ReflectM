Role: You are a Senior Full-Stack Engineer. Help me build ReflectM, a web app that generates Spotify playlists from natural language prompts using Gemma 3 27B (via OpenRouter) and Supabase.1. Technology StackFramework: Next.js 14+ (App Router).Styling: Tailwind CSS + shadcn/ui (Tabs, Card, Input, Button, ScrollArea, Skeleton).Backend/Auth: Supabase (Spotify OAuth).AI Logic: Supabase Edge Functions (Deno) calling OpenRouter API.Music: Spotify Web SDK (spotify-web-api-node).2. Feature Set to ImplementCore: User types a mood prompt $\rightarrow$ AI generates a tracklist $\rightarrow$ App creates a Spotify playlist.Contextual Awareness: Automatically detect user's local weather and time of day to influence the prompt.Main Character Narrative: AI returns a 2-sentence "movie scene" story for the playlist.Discovery Toggle: A UI switch to either "Stay in Comfort Zone" (frequent artists) or "Discovery Mode" (obscure artists).History (Reflections): Save every generated prompt and narrative to a Supabase table.3. Make Database Schema (SQL)Please ensure the app can interact with the tables 4. Step-by-Step Task ListStep 1: Auth SetupCreate a Spotify OAuth login using @supabase/auth-helpers-nextjs.Required Scopes: playlist-modify-public, user-top-read, user-read-private.Step 2: AI Edge Function (The Brain)Write a Supabase Edge Function to call OpenRouter (google/gemma-3-27b-it:free).System Prompt: "You are ReflectM. Return ONLY a JSON object: { "playlist_name": string, "tracks": [{ "song": string, "artist": string }], "narrative": string, "valence": number, "energy": number }."Ensure it accepts weather and time as context.Step 3: Frontend Interface (shadcn/ui)Build a "Glassmorphism" dashboard.Top: A large Textarea for the mood prompt.Middle: A "Discovery Mode" Switch and "Weather Sync" Badge.Bottom: A Card to display the "Main Character Narrative" and a ScrollArea for the generated tracklist.Step 4: Spotify Integration LogicCreate a utility function to:Loop through the AI-generated tracklist.Use spotifyApi.searchTracks() to get URIs.Use spotifyApi.createPlaylist() and addTracksToPlaylist().Step 5: Visual PolishCreate a dynamic background "Aura." Use the valence and energy values from the AI to change the CSS gradient colors (e.g., High valence = bright gold/pink; Low valence = deep purple/blue).5. Code Structure Request"Please start by generating the Supabase Edge Function code and the Next.js Dashboard page that handles the form submission and the loading state using shadcn Skeletons."
